/* ============================================================================
   SCRIPT DEFINITIVO PARA INSERTAR PRODUCTOS (FUNCIONA EN PRODUCCIÃ“N)
   ============================================================================

   Este script NO intenta importar mÃ³dulos.
   Usa Firestore directamente desde el objeto global window.

   INSTRUCCIONES:
   1. Inicia sesiÃ³n como ADMINISTRADOR (demo@frostware.com)
   2. Abre la consola de Chrome (F12)
   3. Copia y pega TODO este cÃ³digo
   4. Presiona Enter
   5. Recarga la pÃ¡gina para ver el producto

   ============================================================================ */

(async function() {
  console.log('ğŸš€ Iniciando inserciÃ³n de producto...');

  try {
    // Importar mÃ³dulos de Firebase desde CDN
    const { getApps } = await import(
      'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js'
    );
    const { getAuth } = await import(
      'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js'
    );
    const { getFirestore, doc, setDoc, serverTimestamp } = await import(
      'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js'
    );

    // Esperar a que Firebase estÃ© inicializado (con retry)
    console.log('â³ Esperando a que Firebase estÃ© listo...');
    let apps = getApps();
    let attempts = 0;
    const maxAttempts = 10;

    while (apps.length === 0 && attempts < maxAttempts) {
      await new Promise(resolve => setTimeout(resolve, 500));
      apps = getApps();
      attempts++;
      console.log(`   Intento ${attempts}/${maxAttempts}...`);
    }

    if (apps.length === 0) {
      console.error('âŒ Firebase no estÃ¡ inicializado despuÃ©s de esperar');
      console.error('   Recarga la pÃ¡gina y espera unos segundos antes de ejecutar el script');
      return;
    }

    const app = apps[0];
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Verificar que estÃ¡s logueado
    if (!auth.currentUser) {
      console.error('âŒ No estÃ¡s logueado. Inicia sesiÃ³n como administrador primero.');
      console.error('   Ve a #/auth para iniciar sesiÃ³n');
      return;
    }

    console.log('âœ… Usuario:', auth.currentUser.email);
    console.log('âœ… Firestore conectado');

    // ========================================================================
    // DATOS DEL PRODUCTO - MODIFICA AQUÃ PARA CREAR OTROS PRODUCTOS
    // ========================================================================

    const productData = {
      // ID Ãºnico del producto
      id: 'north-atlantic-ops',

      // Nombres bilingÃ¼es
      name: {
        es: 'Procedimientos Operacionales del AtlÃ¡ntico Norte',
        en: 'North Atlantic Operational Procedures'
      },
      title: {
        es: 'Procedimientos Operacionales del AtlÃ¡ntico Norte',
        en: 'North Atlantic Operational Procedures'
      },

      // Descripciones bilingÃ¼es
      description: {
        es: 'Un banco de preguntas completo para pilotos transoceÃ¡nicos que operan en el espacio aÃ©reo del AtlÃ¡ntico Norte. Basado en documentos oficiales de OACI con referencias y justificaciones.',
        en: 'A comprehensive question bank for transoceanic pilots operating in North Atlantic airspace. Based on official ICAO documents with references and justifications.'
      },
      shortDescription: {
        es: 'Un banco de preguntas completo para pilotos transoceÃ¡nicos que operan en el espacio aÃ©reo del AtlÃ¡ntico Norte. Basado en documentos oficiales de OACI con referencias y justificaciones.',
        en: 'A comprehensive question bank for transoceanic pilots operating in North Atlantic airspace. Based on official ICAO documents with references and justifications.'
      },
      longDescription: {
        es: 'El banco de preguntas mÃ¡s completo para pilotos transoceÃ¡nicos. Estudia procedimientos oficiales de OACI, practica con escenarios reales y aprueba tu certificaciÃ³n de operaciones NAT con confianza.',
        en: 'The most comprehensive question bank for transoceanic pilots. Study official ICAO procedures, practice with real scenarios, and pass your NAT operations certification with confidence.'
      },

      // Precios
      price: 99,
      originalPrice: 150,

      // ImÃ¡genes
      image: 'https://placehold.co/600x400/1a202c/FFFFFF?text=NAT+OPS&font=inter',
      imageURL: 'https://placehold.co/600x400/1a202c/FFFFFF?text=NAT+OPS&font=inter',

      // CategorÃ­a y etiquetas
      category: 'aviation',
      badge: 'Disponible',
      badgeColor: 'blue',
      tags: ['aviation', 'NAT', 'oceanic', 'procedures'],

      // Rating y reseÃ±as
      rating: 5.0,
      reviews: 342,

      // Colores del gradiente
      colors: ['#1b1b25', '#190d36', '#1b1b25'],
      detailGradientColors: ['#1b1b25', '#190d36', '#1b1b25'],

      // CaracterÃ­sticas simples
      features: [
        'Banco de preguntas interactivo',
        'Documentos ICAO oficiales',
        'Referencias y justificaciones',
        'Acceso completo'
      ],

      // CaracterÃ­sticas detalladas con iconos
      detailedFeatures: [
        {
          icon: 'radio',
          title: {
            es: 'Procedimientos de ComunicaciÃ³n',
            en: 'Communications Procedures'
          },
          description: {
            es: 'Domina protocolos de radio HF, operaciones SELCAL y requisitos de reporte de posiciÃ³n para vuelos oceÃ¡nicos.',
            en: 'Master HF radio protocols, SELCAL operations, and position reporting requirements for oceanic flight.'
          }
        },
        {
          icon: 'map',
          title: {
            es: 'Sistemas de NavegaciÃ³n y Rutas',
            en: 'Navigation & Track Systems'
          },
          description: {
            es: 'Aprende sistemas de rutas NAT, procedimientos de waypoints y requisitos RNAV para navegaciÃ³n oceÃ¡nica segura.',
            en: 'Learn NAT track systems, waypoint procedures, and RNAV requirements for safe oceanic navigation.'
          }
        },
        {
          icon: 'cloud',
          title: {
            es: 'MeteorologÃ­a y Ambiente',
            en: 'Weather & Environmental'
          },
          description: {
            es: 'Comprende cartas SIGWX, reporte de turbulencias y cÃ³mo el clima afecta las operaciones NAT.',
            en: 'Understand SIGWX charts, turbulence reporting, and how weather affects NAT operations.'
          }
        },
        {
          icon: 'warning',
          title: {
            es: 'Procedimientos de Emergencia',
            en: 'Emergency Procedures'
          },
          description: {
            es: 'Practica procedimientos de contingencia, desvÃ­os y requisitos ETOPS para operaciones seguras.',
            en: 'Practice contingency procedures, diversions, and ETOPS requirements for safe operations.'
          }
        },
        {
          icon: 'certificate',
          title: {
            es: 'Listo para CertificaciÃ³n',
            en: 'Certification Ready'
          },
          description: {
            es: 'Preguntas diseÃ±adas para coincidir con exÃ¡menes de certificaciÃ³n reales con explicaciones detalladas y referencias.',
            en: 'Questions designed to match real certification exams with detailed explanations and references.'
          }
        },
        {
          icon: 'lightning',
          title: {
            es: 'Aprendizaje Interactivo',
            en: 'Interactive Learning'
          },
          description: {
            es: 'Pistas, explicaciones detalladas y seguimiento de progreso para optimizar tus sesiones de estudio.',
            en: 'Hints, detailed explanations, and progress tracking to optimize your study sessions.'
          }
        }
      ],

      // ConfiguraciÃ³n
      showOnHomepage: true,
      appUrl: '/apps/north-atlantic-procedures/guide.html',
      offerId: null,

      // Timestamps automÃ¡ticos
      createdAt: serverTimestamp(),
      updatedAt: serverTimestamp()
    };

    // ========================================================================
    // INSERCIÃ“N EN FIREBASE
    // ========================================================================

    console.log('ğŸ“ Insertando producto:', productData.id);
    console.log('   Usuario:', auth.currentUser.email);

    await setDoc(doc(db, 'products', productData.id), productData);

    console.log('');
    console.log('âœ… Â¡PRODUCTO INSERTADO EXITOSAMENTE!');
    console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
    console.log('');
    console.log('ğŸ“Š RESUMEN DEL PRODUCTO:');
    console.log('   ğŸ†” ID:', productData.id);
    console.log('   ğŸ“ Nombre (ES):', productData.name.es);
    console.log('   ğŸ“ Nombre (EN):', productData.name.en);
    console.log('   ğŸ’° Precio: $' + productData.price, '(antes $' + productData.originalPrice + ')');
    console.log('   ğŸ“ CategorÃ­a:', productData.category);
    console.log('   â­ Rating:', productData.rating + '/5.0 (' + productData.reviews + ' reviews)');
    console.log('   âœ¨ Features:', productData.features.length, 'simples,', productData.detailedFeatures.length, 'detalladas');
    console.log('   ğŸ¨ Colores:', productData.detailGradientColors.join(', '));
    console.log('');
    console.log('ğŸ”— ENLACES:');
    console.log('   ğŸ“„ Ver producto:', window.location.origin + '/#/product/' + productData.id);
    console.log('   ğŸš€ App URL:', productData.appUrl || 'No definida');
    console.log('');
    console.log('ğŸ“‹ CONTENIDO INCLUIDO:');
    console.log('   âœ“ Nombres bilingÃ¼es (ES/EN)');
    console.log('   âœ“ Descripciones bilingÃ¼es (corta, larga)');
    console.log('   âœ“', productData.features.length, 'caracterÃ­sticas simples');
    console.log('   âœ“', productData.detailedFeatures.length, 'caracterÃ­sticas detalladas con iconos');
    console.log('   âœ“ Gradiente de colores personalizado');
    console.log('   âœ“ Badge, rating y reviews');
    console.log('   âœ“ Timestamps automÃ¡ticos');
    console.log('');
    console.log('ğŸ”„ RECARGA LA PÃGINA para ver el producto en acciÃ³n');
    console.log('');
    console.log('ğŸ’¡ COMANDOS ÃšTILES:');
    console.log('   Ver todos: checkFirebaseProducts()');
    console.log('   Eliminar: deleteProductById("' + productData.id + '")');
    console.log('');
    console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');

    return productData;

  } catch (error) {
    console.error('');
    console.error('âŒ ERROR AL INSERTAR PRODUCTO');
    console.error('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
    console.error('Error:', error.message);
    console.error('Stack:', error.stack);
    console.error('');
    console.error('ğŸ” SOLUCIONES:');
    console.error('   1. AsegÃºrate de estar LOGUEADO como demo@frostware.com');
    console.error('   2. Verifica que estÃ¡s en frostware.com.mx (no localhost)');
    console.error('   3. Espera 2 segundos y vuelve a pegar el script');
    console.error('   4. Si falla, usa Firebase Console directamente');
    console.error('');
    console.error('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
    throw error;
  }
})();

/* ============================================================================
   PLANTILLA PARA FUTUROS PRODUCTOS
   ============================================================================

   Para crear mÃ¡s productos, solo modifica la secciÃ³n "DATOS DEL PRODUCTO":

   1. Cambia el ID (ej: 'mi-nuevo-producto')
   2. Actualiza nombres y descripciones en espaÃ±ol e inglÃ©s
   3. Modifica precio, categorÃ­a, badge
   4. Ajusta features y detailedFeatures
   5. Cambia los colores del gradiente
   6. Copia y pega en la consola

   Iconos disponibles para detailedFeatures:
   'radio', 'map', 'cloud', 'warning', 'certificate', 'lightning',
   'code', 'database', 'shield', 'default'

   ============================================================================ */
